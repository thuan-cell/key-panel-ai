<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Táº¡o mÃ£ kÃ­ch hoáº¡t</title>
  <link rel="stylesheet" href="style.css"> <!-- Optional náº¿u cÃ³ CSS ngoÃ i -->
  <!-- SweetAlert2 cho thÃ´ng bÃ¡o -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- jQuery Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c hÃ m JS Ä‘Æ°á»£c cung cáº¥p -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!-- 
    Dá»±a trÃªn danh sÃ¡ch tá»‡p Ä‘Æ°á»£c cung cáº¥p (genkey.js, unified-auth.js),
    hÃ m 'logout', xá»­ lÃ½ logic xÃ¡c thá»±c,
    lÃ½ tÆ°á»Ÿng nÃªn Ä‘Æ°á»£c Ä‘áº·t trong 'unified-auth.js' Ä‘á»ƒ tá»• chá»©c mÃ£ tá»‘t hÆ¡n.
    Äáº£m báº£o 'unified-auth.js' Ä‘Æ°á»£c bao gá»“m náº¿u nÃ³ chá»©a hÃ m logout.
  -->
  <script defer src="genkey.js"></script>
  <!-- Uncomment the line below if the authentication functions (including logout) are moved to unified-auth.js -->
  <script defer src="unified-auth.js"></script> 
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #4e54c8, #8f94fb);
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      min-height: 100vh; padding: 20px;
    }
    .card {
      background-color: #fff;
      padding: 40px 30px;
      border-radius: 15px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      width: 100%; max-width: 450px; text-align: center; margin-bottom: 20px;
    }
    h2 { margin-top: 0; margin-bottom: 20px; font-size: 1.8rem; color: #333; }
    label { display: block; text-align: left; margin-bottom: 5px; font-weight: 500; color: #555; }
    input[type="text"], input[type="date"], textarea {
      width: 100%; padding: 15px; margin-bottom: 15px;
      border: 1px solid #ccc; border-radius: 10px; font-size: 1rem;
      transition: 0.2s; resize: vertical; min-height: 80px;
    }
    input:focus, textarea:focus { border-color: #4e54c8; outline: none; }
    button {
      width: 100%; padding: 15px;
      background: #4e54c8; color: white; font-size: 1rem;
      border: none; border-radius: 10px;
      cursor: pointer; transition: background 0.3s ease; margin-bottom: 15px;
    }
    button:hover { background: #3b3fbd; }
    button:disabled {
        background: #cccccc;
        cursor: not-allowed;
    }
    .history-button {
      width: auto; display: inline-block; margin-bottom: 20px;
      background: #3498db; padding: 10px 20px; border-radius: 8px; font-size: 0.9rem;
    }
    .history-button:hover { background: #2980b9; }
    .history-container {
      display: none; /* Máº·c Ä‘á»‹nh áº©n, Ä‘Æ°á»£c báº­t/táº¯t bá»Ÿi nÃºt */
      margin-top: 0; text-align: left; max-height: 300px;
      overflow-y: auto; border: 1px solid #ddd; border-radius: 10px;
      padding: 15px; background-color: #f9f9f9;
      width: 100%; max-width: 450px;
    }
    .history-container h3 { margin: 0 0 15px; color: #333; font-size: 1.2rem; }
    .history-item { padding: 10px 0; border-bottom: 1px solid #eee; }
    .history-item:last-child { border-bottom: none; }
    .history-item .date { font-weight: bold; color: #3498db; font-size: 0.9rem; margin-bottom: 5px; }
    .history-item .input { color: #7f8c8d; font-size: 0.9rem; margin-bottom: 5px; }
    .history-item .key { word-break: break-word; color: #2c3e50; font-size: 0.9rem; }
    #historyButtons { margin-top: 15px; text-align: center; }
    .clear-history {
      width: auto; display: inline-block; margin-top: 0;
      background: #e74c3c; color: white; border: none;
      padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;
    }
    .clear-history:hover { background: #c0392b; }

    /* Kiá»ƒu cho nÃºt Ä‘Äƒng xuáº¥t */
    #logoutBtn {
        background: #e74c3c; /* MÃ u Ä‘á» */
        margin-top: 10px; /* ThÃªm khoáº£ng trá»‘ng phÃ­a trÃªn */
    }
    #logoutBtn:hover {
        background: #c0392b; /* MÃ u Ä‘á» Ä‘áº­m hÆ¡n khi di chuá»™t qua */
    }
    /* ÄÃ£ xÃ³a cÃ¡c kiá»ƒu cho form Ä‘Äƒng nháº­p/Ä‘Äƒng kÃ½ vÃ¬ chÃºng khÃ´ng cÃ²n trong tá»‡p nÃ y */
  </style>
</head>
<body>
  <!-- CÃ´ng cá»¥ táº¡o mÃ£ kÃ­ch hoáº¡t -->
  <div class="card" id="keyGenTool"> <!-- Removed style="display: none;" -->
    <h2>ğŸ” CÃ´ng Cá»¥ Táº¡o MÃ£ KÃ­ch Hoáº¡t</h2>
    <label for="serialInput">Serial (client gá»­i):</label>
    <input type="text" id="serialInput" placeholder="Nháº­p serial...">
    <label for="expireInput">NgÃ y háº¿t háº¡n:</label>
    <input type="date" id="expireInput">
    <button id="generateBtn">ğŸ¯ Táº¡o mÃ£ kÃ­ch hoáº¡t</button>
    <label for="result">Káº¿t quáº£:</label>
    <textarea id="result" readonly></textarea>
    <!-- NÃºt Ä‘Äƒng xuáº¥t -->
    <button id="logoutBtn" onclick="logout()">ÄÄƒng xuáº¥t</button> <!-- Removed style="display: none;" -->
  </div>

  <!-- Pháº§n lá»‹ch sá»­ -->
  <button class="history-button" onclick="toggleHistory()" id="historyToggleButton">ğŸ“œ Lá»‹ch sá»­ kÃ­ch hoáº¡t</button> <!-- Removed style="display: none;" -->
  <div id="historyContainer" class="history-container">
    <h3>Lá»‹ch sá»­ kÃ­ch hoáº¡t</h3>
    <div id="historyItems">Äang táº£i lá»‹ch sá»­...</div>
    <div id="historyButtons">
      <button class="clear-history" onclick="clearHistory()">ğŸ—‘ï¸ XÃ³a lá»‹ch sá»­</button>
    </div>
  </div>

  <script>
    // Chá» DOM Ä‘Æ°á»£c táº£i hoÃ n toÃ n
    document.addEventListener('DOMContentLoaded', function() {
      // Kiá»ƒm tra tráº¡ng thÃ¡i Ä‘Äƒng nháº­p
      // Giáº£ Ä‘á»‹nh hÃ m checkAuthStatus() Ä‘Ã£ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a vÃ  cÃ³ sáºµn trong pháº¡m vi toÃ n cá»¥c
      // (vÃ­ dá»¥: trong unified-auth.js hoáº·c má»™t script khÃ¡c Ä‘Æ°á»£c táº£i trÆ°á»›c)
      const isLoggedIn = typeof checkAuthStatus === 'function' ? checkAuthStatus() : false;

      const generateButton = document.getElementById('generateBtn');
      const logoutButton = document.getElementById('logoutBtn');
      const historyToggleButton = document.getElementById('historyToggleButton');
      const historyContainer = document.getElementById('historyContainer');
      const keyGenToolCard = document.getElementById('keyGenTool');


      if (!isLoggedIn) {
        // Náº¿u chÆ°a Ä‘Äƒng nháº­p, vÃ´ hiá»‡u hÃ³a nÃºt táº¡o mÃ£
        if (generateButton) {
          generateButton.disabled = true;
          generateButton.title = 'Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ sá»­ dá»¥ng cÃ´ng cá»¥ nÃ y';
          // TÃ¹y chá»n: Thay Ä‘á»•i vÄƒn báº£n nÃºt hoáº·c thÃªm thÃ´ng bÃ¡o
          // generateButton.textContent = 'ÄÄƒng nháº­p Ä‘á»ƒ táº¡o mÃ£';
        }

        // TÃ¹y chá»n: VÃ´ hiá»‡u hÃ³a cÃ¡c input liÃªn quan
        const serialInput = document.getElementById('serialInput');
        const expireInput = document.getElementById('expireInput');
        const resultTextarea = document.getElementById('result');

        if (serialInput) serialInput.disabled = true;
        if (expireInput) expireInput.disabled = true;
        if (resultTextarea) resultTextarea.disabled = true;


        // TÃ¹y chá»n: áº¨n nÃºt Ä‘Äƒng xuáº¥t vÃ  lá»‹ch sá»­ náº¿u chÆ°a Ä‘Äƒng nháº­p
        if (logoutButton) logoutButton.style.display = 'none';
        if (historyToggleButton) historyToggleButton.style.display = 'none';
        if (historyContainer) historyContainer.style.display = 'none';

        // TÃ¹y chá»n: Hiá»ƒn thá»‹ thÃ´ng bÃ¡o hoáº·c chuyá»ƒn hÆ°á»›ng
        // Swal.fire({
        //     title: 'Truy cáº­p bá»‹ tá»« chá»‘i',
        //     text: 'Vui lÃ²ng Ä‘Äƒng nháº­p Ä‘á»ƒ sá»­ dá»¥ng cÃ´ng cá»¥ nÃ y.',
        //     icon: 'warning',
        //     showCancelButton: false,
        //     confirmButtonText: 'Äi Ä‘áº¿n trang Ä‘Äƒng nháº­p'
        // }).then((result) => {
        //     if (result.isConfirmed) {
        //         window.location.href = 'https://key-panel-aihtml1.onrender.com/auth.html';
        //     }
        // });

        // TÃ¹y chá»n: áº¨n toÃ n bá»™ cÃ´ng cá»¥ táº¡o key náº¿u chÆ°a Ä‘Äƒng nháº­p
        // if (keyGenToolCard) keyGenToolCard.style.display = 'none';


      } else {
        // Náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p, Ä‘áº£m báº£o nÃºt táº¡o mÃ£ Ä‘Æ°á»£c kÃ­ch hoáº¡t (máº·c Ä‘á»‹nh)
        if (generateButton) {
            generateButton.disabled = false;
            generateButton.title = ''; // XÃ³a title náº¿u Ä‘Ã£ Ä‘Äƒng nháº­p
        }
         // Äáº£m báº£o cÃ¡c input Ä‘Æ°á»£c kÃ­ch hoáº¡t
        const serialInput = document.getElementById('serialInput');
        const expireInput = document.getElementById('expireInput');
        const resultTextarea = document.getElementById('result');

        if (serialInput) serialInput.disabled = false;
        if (expireInput) expireInput.disabled = false;
        if (resultTextarea) resultTextarea.disabled = false;

        // Äáº£m báº£o cÃ¡c nÃºt khÃ¡c hiá»ƒn thá»‹
        if (logoutButton) logoutButton.style.display = ''; // Hoáº·c 'block', 'inline-block' tÃ¹y CSS
        if (historyToggleButton) historyToggleButton.style.display = '';
        // historyContainer sáº½ Ä‘Æ°á»£c hiá»ƒn thá»‹/áº©n bá»Ÿi hÃ m toggleHistory()
        if (keyGenToolCard) keyGenToolCard.style.display = '';
      }
    });
  </script>
</body>
</html>
